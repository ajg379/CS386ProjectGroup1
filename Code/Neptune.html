<!-- Declares the doctype as html -->
<!DOCTYPE html>

<html>

<head>

    <!-- Links the css file -->
    <link type="text/css" rel="stylesheet", href="Neptune.css"/>

    <!-- Sets the webpage title -->
    <title>Vulcan Scheduler</title>

</head>

<body>

    <!-- Div for the header bar -->
    <div id="header">

        <img src="images/Logo.png"/>

    </div>

    <!-- Div for the main content body -->
    <div id="main">

        <h1>Vulcan Scheduler</h1>

        <!-- All generated tags are placed into this paragraph tag -->
        <p id="body"></p>

        <!-- Button to add new actions -->
        <button onclick="newIns()">Add New Instruction</button>

        <br>
        <br>

        <!-- Button to finalize all instruction inputs -->
        <button onclick="writeToFile()">Submit</button>

    </div>

        <!-- JavaScript -->
        <script>

            // Instruction counter and JSON text variables
            var insNum = 0;
            var JSONtext;

            // No Idea how this works, but it loads the JSON file into the var
            loadJSON(function(response) {
                JSONtext = JSON.parse(response);
            });

            function loadJSON(callback)
            {

                var xobj = new XMLHttpRequest();

                xobj.overrideMimeType("application/json");
                xobj.open('GET', 'Hardware.json', true);
                xobj.onreadystatechange = function () {

                      if (xobj.readyState == 4 && xobj.status == "200") {
                        callback(xobj.responseText);

                      }

                };

                xobj.send(null);

            }

            // Creates all HTML tags needed to hold instruction entering
            function newIns()
            {

                var newTag = "";

                insNum++;

                newTag += "<h3>Instruction " + insNum + "</h3>";

                newTag += "<p id=\"conHar" + insNum + "\" num=\"" + insNum + "\"></p>";
                newTag += "<p id=\"conCon" + insNum + "\" num=\"" + insNum + "\"></p>";
                newTag += "<p id=\"conInp" + insNum + "\" num=\"" + insNum + "\"></p>";

                newTag += "<p id=\"actHar" + insNum + "\" num=\"" + insNum + "\"></p>";
                newTag += "<p id=\"actCon" + insNum + "\" num=\"" + insNum + "\"></p>";
                newTag += "<p id=\"actInp" + insNum + "\" num=\"" + insNum + "\"></p>";

                newTag += "<p>====================</p>";

                document.getElementById("body").innerHTML += newTag;

                conHar(insNum);
                actHar(insNum);

            }

            // Reads hardware from the JSON are creates a select tag with it
            function conHar(num)
            {

                var conHar = document.getElementById("conHar" + num);
                var newTag = "";
                var count;

                newTag += "<h4>Select Hardware for Condition " + num + "</h4>";
                newTag += "<select onchange=\"conCon(" + num + ")\" ";
                newTag += "id=\"conHarSelect" + num + "\">";
                newTag += "<option selected disabled hidden style='display: none' value=''></option>";

                for (count = 0; count < JSONtext.length; count++)
                {
                    newTag += "<option>";
                    newTag += JSONtext[count].Name;
                    newTag += "</option>";
                }

                newTag += "</select>";

                conHar.innerHTML += newTag;

            }

            // Reads the input from the hardware selection and creates a
            // select tag with the available conditions
            function conCon(num)
            {

                var conCon = document.getElementById("conCon" + num);
                var e = document.getElementById("conHarSelect" + num);
                var value = e.options[e.selectedIndex].text;
                var newTag = "";
                var count;
                var index;

                for (count = 0; count < JSONtext.length; count++)
                {
                    if (JSONtext[count].Name == value)
                    {
                        index = count;
                    }
                }

                conCon.innerHTML = "";
                document.getElementById("conInp" + num).innerHTML = "";

                newTag += "<h4>Select Condition " + num + "</h4>";
                newTag += "<select onchange=\"conInp(" + num + ")\" ";
                newTag += "id=\"conConSelect" + num + "\">"
                newTag += "<option selected disabled hidden style='display: none' value=''></option>";

                for (count = 0; count < JSONtext[index].Conditions.length; count++)
                {
                    newTag += "<option>";
                    newTag += JSONtext[index].Conditions[count].Name;
                    newTag += "</option>";
                }

                newTag += "</select>";

                conCon.innerHTML += newTag;

            }

            // Reads the input from the condition selection and creates a select
            // tag with the needed inputs
            function conInp(num)
            {

                var conInp = document.getElementById("conInp" + num);
                var e = document.getElementById("conConSelect" + num);
                var value = e.options[e.selectedIndex].text;
                var newTag = "";
                var count1, count2;
                var index1, index2;

                for (count1 = 0; count1 < JSONtext.length; count1++)
                {
                    for (count2 = 0; count2 < JSONtext[count1].Conditions.length; count2++)
                    {
                        if (JSONtext[count1].Conditions[count2].Name == value)
                        {
                            index1 = count1;
                            index2 = count2;
                        }
                    }
                }

                conInp.innerHTML = "";

                newTag += "<h4>Fill Out Inputs</h4>";

                newTag += "<form>";

                for (var key in JSONtext[index1].Conditions[index2].Inputs)
                {

                    newTag += key

                    if (JSONtext[index1].Conditions[index2].Inputs[key] == "INT")
                    {
                        newTag += "<input type=\"number\"/>";
                    }
                    else if (JSONtext[index1].Conditions[index2].Inputs[key] == "FLOAT")
                    {
                        newTag += "<input type=\"number\" step=\"0.01\"/>";
                    }
                    else
                    {
                        newTag += "<input type=\"text\"/>";
                    }

                    newTag += "<br>";

                }

                newTag += "</form>";

                conInp.innerHTML += newTag;

            }

            // Reads hardware from the JSON and creates a select tag with it
            function actHar(num)
            {

                var actHar = document.getElementById("actHar" + num);
                var newTag = "";
                var count;

                newTag += "<h4>Select Hardware for Action " + num + "</h4>";
                newTag += "<select onchange=\"actAct(" + num + ")\" ";
                newTag += "id=\"actHarSelect" + num + "\">";
                newTag += "<option selected disabled hidden style='display: none' value=''></option>";


                for (count = 0; count < JSONtext.length; count++)
                {
                    newTag += "<option>";
                    newTag += JSONtext[count].Name;
                    newTag += "</option>";
                }
                newTag += "</select>";

                actHar.innerHTML += newTag;

            }

            // Reads the input from the hardware selection and creates a
            // select tag with the available actions
            function actAct(num)
            {

                var actCon = document.getElementById("actCon" + num);
                var e = document.getElementById("actHarSelect" + num);
                var value = e.options[e.selectedIndex].text;
                var newTag = "";
                var count;
                var index;

                for (count = 0; count < JSONtext.length; count++)
                {
                    if (JSONtext[count].Name == value)
                    {
                        index = count;
                    }
                }

                actCon.innerHTML = "";
                document.getElementById("actInp" + num).innerHTML = "";

                newTag += "<h4>Select Action " + num + "</h4>";
                newTag += "<select onchange=\"actInp(" + num + ")\" ";
                newTag += "id=\"actActSelect" + num + "\">";
                newTag += "<option selected disabled hidden style='display: none' value=''></option>";

                for (count = 0; count < JSONtext[index].Actions.length; count++)
                {
                    newTag += "<option>";
                    newTag += JSONtext[index].Actions[count].Name;
                    newTag += "</option>";
                }

                newTag += "</select>";

                actCon.innerHTML += newTag;

            }

            // Reads the input from the action selection and creates a select
            // tag with the needed inputs
            function actInp(num)
            {

                var actInp = document.getElementById("actInp" + num);
                var e = document.getElementById("actActSelect" + num);
                var value = e.options[e.selectedIndex].text;
                var newTag = "";
                var count1, count2;
                var index1, index2;

                for (count1 = 0; count1 < JSONtext.length; count1++)
                {
                    for (count2 = 0; count2 < JSONtext[count1].Actions.length; count2++)
                    {
                        if (JSONtext[count1].Actions[count2].Name == value)
                        {
                            index1 = count1;
                            index2 = count2;
                        }
                    }
                }

                actInp.innerHTML = "";

                newTag += "<h4>Fill Out Inputs</h4>";

                newTag += "<form>";

                for (var key in JSONtext[index1].Actions[index2].Inputs)
                {

                    newTag += key

                    if (JSONtext[index1].Actions[index2].Inputs[key] == "INT")
                    {
                        newTag += "<input type=\"number\"/>";
                    }
                    else if (JSONtext[index1].Actions[index2].Inputs[key] == "FLOAT")
                    {
                        newTag += "<input type=\"number\" step=\"0.01\"/>";
                    }
                    else
                    {
                        newTag += "<input type=\"text\"/>";
                    }

                    newTag += "<br>";

                }

                newTag += "</form>";

                 actInp.innerHTML += newTag;

            }

            // Not finished yet. Will call the necessary PHP functions to write
            // to a file and allow the user to download it
            function writeToFile()
            {

            }

        </script>

</body>

</html>
